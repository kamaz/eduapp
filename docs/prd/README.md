# Product Requirements Document (PRD)

## ğŸ§© Problem Identification

Children learn best when education feels **personal**, **engaging**, and **connected to their world** â€” but today's learning materials are often **static**, **generic**, and **disconnected from individual needs or interests**.

Traditional classroom environments, constrained by large pupil-to-teacher ratios, make it difficult to give every child the tailored attention they deserve. As a result, children who struggle may fall further behind, while those who excel are often not challenged enough to reach their full potential or even fall behind as they are bored.

This imbalance creates two types of disengagement â€” frustration from those who find learning too hard, and boredom from those who find it too easy. **Both limit confidence, curiosity, and long-term academic growth.**

Parents, tutors, and teachers need a shared tool that adapts learning experiences to each child's ability, interest, and pace, while tracking their progress across the curriculum â€” ensuring that every child is **continuously supported**, **encouraged**, and **challenged to achieve greatness**.

### Problem Statement

- **Children** lose motivation when lessons are too difficult, repetitive, or not engaging enough for their ability level.
- **Advanced learners** arenâ€™t pushed to excel because teachers must focus attention on struggling pupils.
- **Parents and tutors** lack the tools to personalize learning and monitor progress against both curriculum goals and long-term readiness (e.g., 11+, GCSE).
- **Teachers** have limited visibility into what happens at home or in tutoring sessions, creating fragmented progress data.
- **Families** lack a single, trusted platform to understand where the child is now, where theyâ€™re heading, and what they can do to help them get there.

### Proposed Solution

This application introduces an AI-powered learning companion that empowers children, parents, tutors, and teachers to co-create a personalized educational journey.

By analyzing lesson materials (photos, uploaded worksheets, or text), the system automatically:

- Generates adaptive exercises tailored to the child's ability, interest, and learning style.
- Aligns with the **UK National Curriculum**, ensuring that progress maps directly to academic milestones and exam readiness.
- Tracks the child's journey through both short-term achievements (lesson mastery) and long-term goals (curriculum completion, exam preparation).
- Provides AI-driven guidance for parents, such as:
  - "Your child would benefit from two reasoning challenges this week"
  - "Your child is ready to move to the next reading level."
  - "Visit the National Gallery this weekend and ask your child to describe paintings using adjectives â€” perfect for their literacy goals."
    These recommendations bridge digital learning with real-world experiences, making education natural, creative, and memorable.
- **Gamifies learning** to sustain motivation and build confidence through positive reinforcement and achievable challenges.

Future versions will expand the journey tracking system to include **soft skills** and **career orientation** â€” identifying a childâ€™s natural strengths in logic, creativity, communication, and problem-solving to help guide future learning and interests.

### Example Scenario

Mezi, an 9-year-old preparing for her 11+ exam, is learning fractions. Her tutor uploads a photo of a worksheet, and the app instantly generates new fraction problems using examples from Meziâ€™s favourite topic â€” LEGO building.
Mezi completes the tasks on her tablet, receives immediate feedback, and earns achievement badges for accuracy and presentation.

The app recognizes Meziâ€™s proficiency and automatically introduces slightly more challenging problems, ensuring she stays engaged. His parents receive a visual progress dashboard showing that Mezi is ahead in fractions but could benefit from more reasoning practice.
They also see AI-guided suggestions for family activities â€” such as playing a card game involving fractions or using kitchen measurements to practice ratios â€” helping them reinforce learning effortlessly through play.

### âœ… Key Problems Solved

- Lack of personalized, adaptive learning materials for children aged 4+
- Low engagement and motivation due to generic exercises
- Limited feedback integration across children, parents, tutors, and teachers
- Poor visibility of progress and curriculum coverage
- Inefficient process for creating, tracking, and sharing child-specific learning activities

### ğŸ¯ Mission Statement

> To help every child achieve greatness â€” by making learning personal, engaging, and continuously challenging at just the right level, empowering families and educators to guide each childâ€™s journey toward lifelong success.

## ğŸ¯ Target Audience

### Overview

The app builds a 360Â° profile of each child by combining data from multiple sources to understand their academic ability, interests, motivation, and wellbeing. The platform connects children, parents, tutors, and teachers in a collaborative learning ecosystem.
It adapts dynamically based on continuous feedback from everyone involved â€” creating a living, evolving profile of each child that grows smarter over time.

Every interaction â€” whether itâ€™s a parentâ€™s observation, a tutorâ€™s note, or the childâ€™s own feedback â€” strengthens the AIâ€™s understanding of how that child learns best.

Each participant â€” child, parent, tutor, and teacher â€” contributes unique observations, forming a Unified Child Profile that captures:

- Learning preferences and interests
- Emotional state and engagement
- Health and wellbeing indicators (from smart devices like watches)
- Performance trends and progress against curriculum goals

This shared intelligence enables the AI to make context-aware recommendations that balance academic growth, wellbeing, and long-term potential.

### ğŸ‘§ Child â€” The Learner

Age Range (Initial Target): 4â€“11 years (Early years to 11+ prep)

Needs:

- Learning that's fun, fair, and fitted to their ability.
- Recognition, motivation, and balance (not overwhelm).
- The feeling of being seen and understood â€” not compared.
- Get personalised exercises adapted to their interests, energy, and learning style.
- Learn through familiar themes â€” e.g., dinosaurs, games, or favorite stories â€” to make abstract ideas relatable.
- Receive instant feedback on answers, handwriting, and presentation.
- Track their own progress visually, celebrating milestones and achievements.
- Benefit from an AI that understands when theyâ€™re tired or distracted (via smartwatch data) and adjusts activity intensity or type accordingly.
- Engage in a balanced learning journey that values curiosity, confidence, and wellbeing â€” not just academic results.

Value Provided:

- Adaptive, gamified tasks that evolve with their feedback.
- Ability to express likes/dislikes ("I liked this story", "This was hard but fun").
- Prompts to share interests ("Whatâ€™s your favourite book?", "Do you like building things?").
- Health-friendly reminders â€” hydration, short breaks, and "brain rest" cues.

Data Shared with AI:

- Enjoyment feedback after tasks (e.g., happy/neutral/sad face).
- Self-assessed difficulty ratings.
- Interests and preferred learning styles (stories, puzzles, visual cues).
- Simple wellbeing check-ins ("How do you feel today?").

This data helps the AI tailor future exercises â€” for example, switching from text-based tasks to hands-on examples if a child prefers visual learning.

### ğŸ‘© Parent â€” The Guide and Decision Maker

Profiles: Everyday parent and homeschooling parent.

Needs:

- To understand how their child learns, not just what they know.
- To receive specific ideas that fit their childâ€™s temperament and interests.
- To maintain healthy study rhythms at home.
- Gain insight into how their child learns best â€” and receive AI-driven suggestions for activities, outings, and home-based lessons aligned with the national curriculum.
  Example: "Practice addition with a deck of cards" or "Visit the National Gallery to explore adjectives in paintings."
- Get help explaining difficult topics â€” the AI provides multiple approaches to present the same concept in ways that suit the childâ€™s learning style.
- Plan learning activities and daily routines: reminders for breaks, hydration, mindfulness, and rest.
- Receive guidance on how to support their childâ€™s academic journey and long-term goals, including exam readiness and future career orientation.
- Access a shared child profile that collects inputs from teachers, tutors, and smart devices â€” offering a holistic picture of progress and wellbeing.
  - For homeschooling parents:
  - Easily create lessons aligned with the national curriculum.
  - Generate printable or tablet-ready exercises tailored to the childâ€™s level.
  - Discover ideas for off-site activities that reinforce classroom concepts through real-world experiences.

Value Provided:

- AI-driven insights combining academic data with family feedback ("Lily focuses better in the morning â€” schedule math earlier").
- Tools to log observations ("Child was tired after lunch", "Loved yesterdayâ€™s art-based math activity").
- Wellbeing prompts â€” reminders to plan breaks, meals, water, and rest.
- Suggestions for learning activities that match mood, weather, and energy level.
- Catch-up support when children miss school or lessons.

Data Shared with AI:

- Home observations (focus, motivation, energy levels).
- Activity feedback (what worked, what didnâ€™t).
- Daily rhythm (when the child eats, drinks, or takes breaks).
- Emotional and behavioural notes ("Seemed frustrated by word problems").

Result:
The AI refines recommendations â€” e.g., "Try shorter reading sessions after lunch" or "Incorporate drawing when explaining story structure."

### ğŸ‘©â€ğŸ« Tutor â€” The Learing Architect

Profile: Private tutors managing studentsâ€™ academic gaps and exam readiness.

Needs:

- A fast way to understand the whole learner â€” not just their test scores.
- Efficient feedback tools to track progress across sessions.
- Access a childâ€™s learning history and current performance instantly â€” no need to start from scratch.
- Get AI support for planning sessions, generating exercises, and tracking homework across multiple students.
- Receive suggestions for addressing learning gaps or preparing for exams.
- Assess homework directly within the app, even outside tutoring hours, with AI support for grading and feedback.
- Collaborate seamlessly with parents and teachers to align on the childâ€™s progress.
- Log observations about focus, comprehension, or wellbeing â€” contributing to the unified child profile.

Value Provided:

- Unified learner profiles integrating data from home and school.
- Catch-up plans for children who missed material.
- Quick AI summaries ("Student performs best with visuals and real-life examples").
- The ability to log notes after each session ("Understood fractions better using pizza examples").

Data Shared with AI:

- Lesson performance and engagement.
- Observations about preferred teaching styles and progress patterns.
- Homework quality and time to complete.
- Notes about emotional tone (confidence, frustration, curiosity).

Result:
The AI adapts new exercises and reports across all connected adults â€” aligning tutor, parent, and teacher insight into a unified strategy for the child.

### ğŸ‘©â€ğŸ« Teacher â€” The Curriculum Anchor

Profile: Classroom educators needing efficient differentiation and feedback loops.

Needs:

- To track each childâ€™s learning style and pace without adding workload.
- To support both struggling and excelling pupils effectively.
- Quickly identify students who need extra support or additional challenges.
- Assign differentiated homework or enrichment activities with one click, based on classroom performance.
- Provide feedback to parents and tutors through shared reports â€” improving home-school communication.
- Use AI to generate extra practice materials from photos of classroom lessons or worksheets.
- Track curriculum coverage and identify learning gaps at both individual and class level.
- View wellbeing data (e.g., fatigue, focus indicators) to understand performance fluctuations beyond academics.

Value Provided:

- Access to aggregated learning insights from home and tutoring contexts.
- Instant tools to assign enrichment or reinforcement work.
- Feedback options that feed directly back into the AI profile.

Data Shared with AI:

- Classroom performance observations ("Engages better in group activities").
- Assessment results and curriculum progress.
- Notes on classroom behaviour and participation.

Result:
The AI learns when and how the child thrives in different environments â€” balancing academic challenge and emotional wellbeing.

### ğŸ§  The Shared Learning Graph

At the core of the platform is the AI Learning Graph â€” a continuously updated model of the childâ€™s:

- Academic progress (curriculum mastery)
- Cognitive preferences (how they understand best)
- Emotional and wellbeing signals (energy, motivation, confidence)
- Context (recent activities, breaks, sleep, hydration)

Each persona contributes to this graph:

| Persona | Type of data                   | Example                                       |
| ------- | ------------------------------ | --------------------------------------------- |
| Child   | Enjoyment & self-assessment    | "This story was fun!"                         |
| Parent  | Daily routines & observations  | "Tired after lunch; prefers morning reading." |
| Tutor   | Session notes & learning style | "Understood faster with real-life examples."  |
| Teacher | Curriculum data & assessments  | "Ahead in numeracy; needs reading focus."     |

### ğŸ•’ Day in the Life (Illustrative Use Cases)

[TO BE UPDATED WITH USER RESEARCH]

Child (Liam, age 8)

- 8:00 AM â€” Opens app for a short warm-up quiz before school; AI adjusts difficulty based on previous dayâ€™s focus.
- 3:30 PM â€” After school, uploads a photo of todayâ€™s math worksheet. App generates new practice questions using his favorite superhero characters.
- 5:00 PM â€” Wristband detects low energy; app suggests a 10-minute break and mindfulness game before resuming.
- 7:00 PM â€” Completes â€œadjective challengeâ€ about his favorite cartoons, receives encouraging feedback badge.

Parent (Amelia, homeschooling two children)

- 9:00 AM â€” Opens dashboard to review curriculum progress; sees both children are ahead in reading but need extra practice in fractions.
- 10:00 AM â€” App suggests using cooking (measuring ingredients) to reinforce fractions.
- 1:00 PM â€” Logs observations about her sonâ€™s energy levels and reading interest.
- 6:00 PM â€” App recommends a local museum trip for weekend creative writing inspiration.

Tutor (James, maths specialist)

- 4:00 PM â€” Reviews homework results of five students from the same class; identifies patterns of struggle in long division.
- 4:30 PM â€” App generates tailored practice sheets and visual explanations for next session.
- 8:00 PM â€” Provides feedback through the app without needing live sessions, syncing notes with parents and teachers.

Teacher (Ms. Roberts, Year 5)

- 9:00 AM â€” Checks dashboard to find three students ready for accelerated challenges.
- 11:00 AM â€” Uploads photo of whiteboard to automatically generate differentiated homework.
- 3:30 PM â€” Sees holistic student reports including wellbeing data â€” helps adjust class activities for next week.

## Platform strategy

### Tablet (Core Experience)

Tablets offer the ideal balance of interactivity, visual feedback, and accessibility for primary learners.

- Primary learning interface for children.
- Supports stylus input for handwriting, drawing, and annotation.
- Enables interactive exercises, gamified lessons, and real-time feedback.
- Allows camera-based capture of worksheets, lessons, or physical materials.
- Offline-first mode for uninterrupted learning during travel or limited connectivity.
- Integrates motion and focus tracking (optional parental consent).

### Physical (Print-Based Learning Experience)

Physical learning supports kinesthetic engagement, encourages focus away from screens, and maintains inclusivity for families with limited device access.

- The app automatically generates printable worksheets tailored to the childâ€™s age, skill level, and interests.
- Parents or tutors can print these exercises for offline, hands-on practice â€” ideal for early learners developing writing and fine motor skills.
- Once completed, the page can be scanned or photographed within the app.
- The AI evaluates correctness, handwriting quality, and neatness, then feeds results into the childâ€™s digital learning profile.
- Parents can store or share paper results through the app for longitudinal tracking.

### Mobile App (Parents, Tutors, and Teachers)

Mobile enables lightweight engagement for adults without interrupting their routines.

- Optimized for quick access to insights, assignments, and progress updates.
- Parents can log observations, track energy levels, or scan completed worksheets.
- Tutors and teachers can upload photos of materials or assign new exercises.
- Push notifications for reminders, wellbeing alerts, and learning achievements.
- Smartwatch integration handled via companion connection (Apple Health, Fitbit, Garmin).

### Web App (Administrative and Extended Access)

The web platform is essential for scalability, data management, and professional collaboration.

- Used by teachers, schools, and tutoring centers to manage multiple children.
- Provides analytics dashboards, reporting tools, and curriculum tracking.
- Supports drag-and-drop lesson planning and custom content creation.
- Enables printing of worksheets and physical task packs.
- Secure role-based access for different personas.

### Wearable & IoT Integration (Optional)

Real-world data supports balanced learning that values wellbeing as much as academic progress.

- Integrates with smartwatches and wellbeing trackers to collect optional biometric data (e.g., heart rate, activity, rest).
- The Wellbeing AI Model uses this input to adjust lesson intensity and recommend breaks.
- All data is anonymized, consent-based, and fully compliant with child privacy standards (GDPR-K, COPPA).

### ğŸ§  Cross-Platform Continuity

All experiences â€” tablet, mobile, web, print, and wearables â€” are synchronized through a unified AI-driven cloud system, ensuring:

- Consistent understanding of progress, engagement, and wellbeing.
- Real-time updates across all devices and users.
- Context-aware recommendations (e.g., switching from digital to print tasks if a child seems overstimulated).

## ğŸš€ Core MVP Features (3-Month Build Target)

### ğŸ‘§ For Children

#### âœ¨ Smart Onboarding Experience

Guided introduction where the child (with parent support) answers playful questions about:

- Interests (books, games, animals, hobbies, heroes, etc.)
- Preferred ways to learn (stories, visuals, puzzles, experiments)
- Mood and motivation (what makes learning â€œfunâ€)

Child-friendly visuals and voice interaction to make onboarding engaging.

#### AI-Personalised Exercises

- Tasks automatically reflect the childâ€™s interests (e.g., â€œLEGO fractions,â€ â€œfootball grammar examplesâ€).
- Exercises mapped to UK National Curriculum for Maths & English (Key Stage 1â€“2).

#### Interactive & Paper Modes

- Complete tasks digitally or via printable worksheets.
- Parents can take a photo of written answers for assessment and feedback.

#### Positive Reinforcement

- Encouraging animations, badges, and verbal praise (â€œYouâ€™re improving so fast!â€).
- Child-facing feedback focuses on progress, not just correctness.

### ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ For Parents

#### Parent Onboarding

- Parents provide structured context about the child:
- Learning challenges or preferences.
- Reading habits and media interests.
- Any wellbeing or attention factors (e.g., struggles with focus or fine motor skills).
- Optionally, add simple daily info like sleep, energy, or meal notes to refine context.

#### Curriculum Map View

- Clear visual mapping of all exercises to UK curriculum topics.
- Shows coverage, progress, and skill mastery (e.g., â€œFractions 60% completeâ€).

#### AI Activity Generator

Parents can upload a school worksheet or choose a topic, and the system:

- Creates new personalised examples.
- Suggests different explanation styles (story, analogy, visual).

#### Performance Summary

Tracks completed activities, learning gaps, and progress trends.

#### Print & Upload Support

- Generate printable worksheets.
- Upload photos for OCR-based auto-assessment.

#### Wellbeing & Routine Support

- Gentle reminders for breaks, hydration, and rest balance.

### System & AI

#### UK National Curriculum Graph

Structured map linking learning goals, age expectations, and progression paths.

#### AI Personalisation Layer

Combines onboarding inputs (interests, parent data, behaviour patterns) with performance metrics to adapt exercises.

#### OCR & Handwriting Recognition (Light MVP)

Detects answers and basic markings for correctness tracking.

#### Privacy by Design

Child data encrypted, locally stored when possible, and parent-owned.

#### Analytics & Feedback Loop

Tracks engagement, learning gains, and parental satisfaction for iteration.

#### ğŸ§  AI Personalisation Layer

- Builds and continuously updates a unique learner profile per child based on:
  - Onboarding inputs (interests, habits, learning style).
  - Parent observations and engagement metrics.
  - Curriculum progress and performance data.
- Generates AI-personalised exercises and customised printable worksheets aligned to the UK National Curriculum.
- Suggests different explanation styles (story, visual, practical examples) to suit the learnerâ€™s preference.

#### ğŸ“˜ Curriculum, Subject, and Task Management

- Curriculum Graph Engine mapping UK National Curriculum to:
  - Subjects â†’ Topics â†’ Lessons â†’ Tasks.
- Enables easy search and auto-tagging of uploaded materials.
- Supports curriculum versioning for regional or future expansions (e.g., Polish curriculum phase 2).
- Includes admin interface (phase 2) for adding or updating learning materials.

#### ğŸ–¨ï¸ Printable Worksheet Generator

- Converts AI-created or parent-uploaded exercises into printable PDF sheets.
- Includes QR code or ID for quick scanning/uploading back into the system.
- Handles automatic mapping of completed worksheets to child progress tracking.
- Optimised for both home printing and tablet stylus use.

#### ğŸ‘‹ User Onboarding & Registration

- Guided, gamified onboarding flow for children.
- Parent onboarding captures contextual data (childâ€™s interests, habits, learning support needs).
- Multi-role account system (Child, Parent, Tutor, Teacher) â€” MVP activates only Child + Parent roles.
- Simple email-based sign-up/login (social or Apple/Google sign-in optional later).

#### ğŸ’³ Subscription & Payment Module

- Enables freemium-to-premium model:
  - Free plan â†’ limited topics or weekly tasks.
  - Paid plan â†’ full curriculum access, adaptive AI feedback, printable tracking.
- Secure payment handling through Stripe or Paddle integration.
- Parent dashboard for subscription management (plan type, renewal, invoices).

#### âœ‰ï¸ Email & Notification Services

- Transactional emails: registration confirmation, password reset, subscription receipts.
- Progress and reminder notifications:
  - Child progress summaries.
  - Suggested next exercises.
  - Gentle reminders for wellbeing breaks.
- Event-based notification rules (e.g., â€œnew worksheet availableâ€ or â€œreview readyâ€).

#### ğŸ” Data & Security

- GDPR-compliant design with explicit parental consent for child data.
- Secure token-based authentication and encrypted storage.
- Child data fully exportable and erasable on request.
- Analytics anonymised to support iterative improvement without exposing private data.

#### ğŸ§© Integration Layer

- Image Upload â†’ OCR â†’ Answer Validation Pipeline.
- Future integrations:
  - Smartwatch health data (wellbeing insights).
  - School/tutor dashboards.
  - External learning content providers.

#### ğŸ§  AI & Data Foundation

- Curriculum Knowledge Graph: Ontology connecting topics, difficulty, and prerequisites.
- Child Learning Model: Dynamic learner representation combining:
  - Knowledge state.
  - Engagement metrics.
  - Preference profile.
- Activity Recommendation Engine: AI model that suggests next best tasks based on performance, mood, and engagement history.
- Feedback Loop: Continuous refinement using parent input and child outcomes.

### ğŸ§© Stretch Goals (If Capacity Allows)

#### Voice Interaction

Read-aloud questions and verbal encouragement for younger learners.

#### Parental Reflection Log

Parents can add notes (â€œMore focused todayâ€, â€œLoved the LEGO exampleâ€).

#### Wellbeing Insights

Integrate smartwatch or sensor data for rest, heart rate, and energy indicators.

#### Offline Support

Capture learning data from printed worksheets offline.

### ğŸ“ˆ Post-MVP Expansion Path

| Phase          | Focus          | Key Additions                                                |
| -------------- | -------------- | ------------------------------------------------------------ |
| MVP (3 months) | Parent + Child | AI onboarding, curriculum mapping, printable & digital tasks |
| Phase 2        | Tutors         | Multi-child dashboards, homework review                      |
| Phase 3        | Teachers       | Classroom feedback, progress analytics                       |
| Phase 4        | Wellbeing      | Smartwatch and physical activity integration                 |
| Phase 5        | Ecosystem      | Shared profiles, peer comparisons, AI career guidance        |

### ğŸ¯ MVP Success Criteria

| Goal                                                      | Metric                                              |
| --------------------------------------------------------- | --------------------------------------------------- |
| Parents successfully create curriculum-aligned activities | â‰¥80% correct mapping rate                           |
| AI onboarding successfully personalises examples          | â‰¥70% of children show higher engagement             |
| Worksheets printed and scanned for tracking               | â‰¥60% of users use print mode                        |
| Parents report better understanding of child progress     | â‰¥4.2/5 satisfaction                                 |
| System adapts difficulty effectively                      | â‰¥70% of activities completed with improvement trend |

## ğŸ§° Technology Stack

### Layered Architecture Diagram

```text
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚               FRONTEND (App)               â”‚
                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                â”‚ React Native (Expo)                        â”‚
                â”‚ React Native Paper & Skia (Canvas, UI)     â”‚
                â”‚ Firebase Auth (Client Auth)                â”‚
                â”‚ WebSocket Client (Realtime Tasks)          â”‚
                â”‚ Local Cache / Offline Mode                 â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ HTTPS / WebSocket
                                       â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚            EDGE API (Backend)              â”‚
                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                â”‚ Cloudflare Workers (TypeScript API Layer)  â”‚
                â”‚ Durable Objects (WS sessions, locks)       â”‚
                â”‚ Cron Triggers (Background Jobs)            â”‚
                â”‚ Presigned Upload URLs (R2)                 â”‚
                â”‚ Auth Validation (Firebase Tokens)          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”
                â”‚      AI & ORCHESTRATION SERVICES (LangChain)â”‚
                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”‚
                â”‚ Node.js / LangChain                         â”‚
                â”‚ Prompt Templates & Lesson Generation        â”‚
                â”‚ Curriculum Embeddings via Vectorize         â”‚
                â”‚ AI-driven Personalisation Logic             â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”˜
                               â”‚              â”‚
               Embeddings/API  â”‚              â”‚ Asset Gen (PDF/Image)
                               â”‚              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚         DATA & STORAGE LAYER               â”‚
                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                â”‚ Cloudflare D1 (Structured Data)            â”‚
                â”‚ Cloudflare Vectorize (Vector Store)        â”‚
                â”‚ Cloudflare R2 (Images, PDFs, uploads)      â”‚
                â”‚ Firebase Auth (Identity only)              â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        Background & Ops:
        - Cloudflare Cron Triggers â†’ Worker Jobs â†’ DO coordination
        - Durable Objects manage live sessions & real-time updates
        - Monorepo with CI/CD, feature flags, and environment mgmt
```

#### Short rationale (one-liners)

- React Native + Expo: single codebase for iOS/Android tablets + phones; fast iteration.
- RN Skia + RN Paper: high-performance stylus/canvas capture + consistent UI primitives.
- Cloudflare Workers (monolith): low-latency edge API, proxied LLM orchestration, central logic without microservices complexity.
- D1: serverless relational store close to Workers for curriculum and progress.
- R2: low-cost, S3-compatible storage for uploaded images and printable PDFs.
- Cloudflare Vectorize: edge-native vector search for semantic retrieval.
- LangChain Service: keeps LLM orchestration out of Workers, where heavier processing and stateful chains are easier to manage.
- Firestore: delegated auth (Firebase Auth), Workers validate tokens â€” keeps identity simple.
- Durable Objects + WebSocket: live review, preview and lightweight coordination (locks, small queues).
- Cron Triggers: scheduled background jobs to refresh profiles and schedule lessons.

### Main data flows

1. Onboarding: RN app â†’ Worker â†’ verify Firebase token â†’ create child profile in D1 â†’ seed interests into Vectorize (via LangChain).
2. Create Exercise: Parent uploads photo or picks topic â†’ Worker stores image in R2 â†’ Worker calls LangChain svc (topic + interests) â†’ LangChain uses Vectorize, returns tasks + PDF â†’ Worker stores metadata in D1 + PDF in R2, notifies client via DO/WebSocket.
3. Paper mode: Parent prints PDF â†’ child does worksheet â†’ parent photographs sheet â†’ RN app uploads to Worker â†’ Worker stores in R2, triggers OCR/validation (LangChain svc / OCR) â†’ Worker updates progress in D1.
4. Scheduled jobs: Cron Trigger â†’ Worker scans D1 â†’ enqueues jobs (locks via DO) â†’ LangChain svc generates next lessons â†’ Worker persists and notifies.

### Client / Frontend

- Framework: React Native (TypeScript) â€” Expo managed workflow.
  Why: Single codebase for iOS/Android tablets + phones; fast iteration and OTA.
- UI: React Native Paper (Material primitives).
- Canvas / Stylus: React Native Skia (stroke capture, pressure, performance).
- Auth (client): Firebase Auth SDK (issue ID tokens). Firestore used only for authentication identity (no learning data).
- Realtime client: WebSocket client connecting to Durable Objects (via Worker).
- Local storage / offline queue: AsyncStorage / SecureStore for queued uploads, stroke caching, small state.
- Testing: Vitest (unit tests for shared logic), React Native Testing Library for components.

### Edge / API (Monolith)

- Runtime: Cloudflare Workers (TypeScript) â€” single monolithic API for MVP.
- Stateful primitives: Cloudflare Durable Objects â€” WebSocket session manager, pub/sub, locks, feature flags.
- Scheduling: Cloudflare Cron Triggers to hit Worker cron endpoints.
- File presign & upload flow: Worker issues presigned URLs to Cloudflare R2.
- Auth bridge: Worker validates Firebase ID tokens per request and maps to D1 user IDs.
- Secrets/config: Cloudflare KV for non-sensitive config; CI secrets for deployment.
- CLI / deploy: Wrangler for Workers.

### AI Orchestration

- Orchestrator service: LangChain (LangChain.js) running as a small Node service (TypeScript) in Cloudflare.
- LLM providers / embeddings: OpenAI (GPT-4-turbo family) or other chosen LLM; use provider for embeddings as needed.
- Vector store: Cloudflare Vectorize (edge-native). LangChain service upserts embeddings into Vectorize and queries it for retrieval.
- Exercise generation + templates: Prompt templates & chains managed in LangChain service. Returns JSON tasks and optional HTML/PDF payloads.
- Integration pattern: Workers proxy to LangChain service (heavy LLM work off-edge). LangChain writes assets to R2 via Worker callbacks or returns payload for Worker to store.

### Data & Storage

- Relational store (canonical): Cloudflare D1 â€” holds child profiles, curriculum graph (subjects â†’ topics â†’ lessons â†’ tasks), progress, scheduled lessons metadata and subscription records (lightweight).
- Object storage (assets): Cloudflare R2 â€” uploaded worksheet images, generated PDFs, thumbnails, and large binary blobs.
- Embeddings / semantic retrieval: Cloudflare Vectorize.
- Auth (identity only): Firebase Auth / Firestore tokens. D1 stores firebase_uid mapping only.

### Media & OCR / PDF

- OCR (initial): Initially multimodal LLM like gemini, as a fallback Google Cloud Vision API (fastest, best accuracy).
- PDF / printable generation: HTML â†’ PDF conversion done in LangChain service (Puppeteer / Playwright or a PDF generation library) and saved to R2. Include QR/task ID in PDF metadata.
- Image processing: Cloudflare Images or Worker-side lightweight image transforms prior to OCR.

### Payments & Notifications

- Payments / subscriptions: Stripe (Checkout + Billing).
- Email (transactional): Postmark / Resend (choose one) for reliable transactional emails.
- Push notifications: Firebase Cloud Messaging for Android / APNs for iOS (via Expo tooling or native integration).
- In-app notifications: WebSocket + Durable Objects for immediate events.

### Realtime & Jobs

- Live streaming & pub/sub: Durable Objects (WebSocket broker) â€” handles stroke streaming, live review presence, and notifications.
- Background scheduled jobs: Cloudflare Cron Triggers â†’ Worker cron endpoints â†’ DO locks â†’ LangChain service generation jobs.
- Queueing pattern: Durable Object small queue or simple HTTP enqueue to LangChain svc for batch processing.

### Observability, Testing & CI/CD

- Repo / monorepo: pnpm + Turborepo (with pnpm workspaces). Structure: `/apps/mobile`, `/apps/worker`, `/apps/langchain`, `/packages/*`.
- Version control & CI: `GitHub` + `GitHub Actions` for `lint`, `vitest`, build, deploy.
- Monitoring & errors: `Cloudflare Analytics` + `Sentry` (LangChain service + RN app).
- Feature flags: `Durable Objects` or lightweight JSON in KV for MVP toggles.
- E2E testing: `Playwright` (if web later) or Detox for RN if needed.

### Dev / Hosting & Deployment

- Workers: Cloudflare Workers via Wrangler + GitHub Actions.
- LangChain service host: Render / Fly / Railway / Vercel (server choice depends on concurrency needs; Render is simple).
- CI/CD pipeline: GH Actions build â†’ tests â†’ deploy Workers (wrangler) & LangChain svc (auto-deploy).
- Local dev: Expo dev client for RN; wrangler dev for Workers; local LangChain dev server.

### Security, Privacy & Compliance

- Parental consent: explicit during onboarding stored in D1; no PII stored without consent.
- Data encryption: R2 at rest + TLS in transit. D1 encrypted at rest as per Cloudflare.
- Auth validation: Workers verify Firebase ID tokens on each request.
- Export & deletion: parents can export or delete child profile (D1 + R2 assets) via API.
- Compliance posture: plan for GDPR-K / COPPA considerations (consent, limited retention, parental control).

### Recommended Libraries / Versions (practical)

- React Native & Expo: latest stable RN + Expo SDK (use Expo SDK 48+ depending on release).
- React Native Skia: @shopify/react-native-skia (match RN/Expo compatibility).
- LangChain: LangChain.js (latest stable), Node 18+.
- Workers: TypeScript target compatible with Wrangler2.
- Cloud SDKs: Cloudflare Workers SDK, Cloudflare Vectorize client, R2 SDK helpers.
- OCR: Google gemini flash model or Google Cloud Vision client.
- PDF: puppeteer-core + chrome-aws-lambda if using serverless, or pdf-lib for programmatic generation.

### Trade-offs & rationale (short)

- Monolith Workers keeps operations simple and low-friction early; Durable Objects handle needed stateful pieces (websockets & locks).
- LangChain separate svc avoids heavy LLM logic in Workers (bundle/runtime issues) while allowing complex chains and 3rd-party SDKs.
- Cloudflare-first stack (D1 / R2 / Vectorize) reduces network latency and vendor sprawl; Vectorize gives edge vector search.
- Firestore for auth centralises identity with a mature provider; D1 remains canonical for learning data to avoid coupling.
- Google Vision OCR gives best accuracy out of the box â€” faster to pilot; Tesseract is cheaper but less accurate (fallback).

### Minimal infra & services to provision (MVP)

- Cloudflare account with: Workers, Durable Objects, D1, R2, Vectorize, KV, Cron Triggers.
- Firebase project (Auth only).
- LangChain service hosting (Render / Fly) + domain / TLS.
- Stripe account + webhook endpoints.
- Google Cloud project.
- GitHub repo + Actions, Turborepo/pnpm.
- Sentry & Postmark/Resend accounts.

## ğŸ“š Data Requirements

### High-level summary

- Short-lived, real-time, session & streaming data â†’ store in Durable Objects (per-child / per-session DOs). Examples: stroke deltas, live presence, attempt buffers, job locks, ephemeral review drafts.
- Canonical, queryable, long-term data â†’ store in Cloudflare D1. Examples: user accounts, canonical child profiles, curriculum graph, finalized attempts, progress snapshots, scheduled lessons, job/audit logs, subscriptions, assets metadata.
- Large binary assets â†’ store in Cloudflare R2 (images, PDFs, stroke blobs). D1/DO store references/IDs.
- Embeddings & semantic retrieval â†’ store in Cloudflare Vectorize (embeddings + metadata pointing to topic/lesson IDs).
- Auth / Identity â†’ Firebase Auth (tokens only). D1 stores firebase_uid mapping.
- AI orchestration â†’ LangChain svc uses Vectorize + returns task JSON / printable HTML; Worker persists results.

### What to store (by category & location)

#### Identity & Accounts

- Where: D1 (canonical users) + Firebase Auth (auth tokens)
- What: user_id, firebase_uid, email, display_name, role, created_at, last_login, settings_json
- Purpose: login, account management, billing mapping

#### Child Profiles & Onboarding

- Where: D1 (children) as canonical; per-child DO caches sessionProfile
- What: child_id, parent_user_id, display_name/alias, DOB (optional), preferences_json (interests, learning_style), consent flags (wearable/third-party), onboarding timestamps
- Purpose: personalize content, seed AI, UI personalization
- Displayed to: parent dashboard, child UI (limited view)

#### Curriculum & Topics

- Where: D1 (curriculum_topics, lessons, tasks) + Vectorize (snippets)
- What: subject, topic_id, title, code (UK ref), description, prerequisites, task templates, difficulty
- Purpose: map generated exercises to curriculum; power discovery & retrieval

#### Generated Lessons & Tasks (definitions)

- Where: D1 (lesson/task metadata), R2 for PDF assets, Vectorize for example snippets
- What: task_id, prompt, expected_answer_json, style, difficulty, asset_r2_url, created_by (ai/user)
- Purpose: present lessons, grade attempts, schedule

#### Attempts & Attempts Buffering

- Where: DO (attemptBuffer) â†’ flush to D1 (attempts) + R2 assets for stroke blobs
- What (buffer): attempt draft, stroke delta ref, preliminary score, client device info, timestamp
- What (persisted): attempt_id, child_id, task_id, user_answer_json, score, presentation_score, correct flag, timestamp
- Purpose: progress calculation, historical reporting, parental feedback
- Displayed to: parent dashboard, tutor view (later)

#### Progress & Mastery Snapshots

- Where: D1 (progress) â€” computed snapshots; DO caches working values for active sessions
- What: topic_id, mastery (0..1), attempts_count, last_practiced_at, history_json
- Purpose: curriculum map, scheduling decisions
- Displayed to: parent dashboard, scheduling engine

#### Live Session State & Stroke Streams

- Where: DO (per-child DO instance)
- What: connected clients, stroke deltas buffer, currentTaskId, session metadata, live presence, draft comments
- Persistence pattern: compact periodic snapshot â†’ R2 + DO meta pointer â†’ D1 asset reference
- Purpose: live review, instant feedback, replay, collaborative sessions
- Displayed to: parent/tutor live view, child preview

#### Assets & Media

- Where: R2 (actual blobs), D1 (assets) for metadata, DO for transient references
- What: r2_url, type (scan/pdf/stroke_blob), ocr_text (optional), created_at, owned_by_child_id
- Purpose: re-ingest scanned worksheets, printable delivery, archival

#### Embeddings & Semantic Metadata

- Where: Cloudflare Vectorize (+ metadata in D1 referencing vector IDs)
- What: embedding vectors, source text snippet ID, topic_id, content_type, created_at, model_version
- Purpose: semantic retrieval for LangChain to generate contextually relevant exercises

#### Scheduled Lessons & Job Metadata

- Where: D1 (scheduled_lessons, jobs)
- What: scheduled_for, status, source, job_payload, result_meta, audit logs
- Purpose: cron/scheduling, monitoring, retries, idempotency

#### Billing & Subscription

- Where: D1 (subscriptions) + Stripe (truth)
- What: stripe_customer_id, plan, status, billing dates
- Purpose: enforce paid features, reporting

### What to process (compute & transforms)

On ingestion

- OCR on uploaded images â†’ extract text (LangChain/OCR), write OCR summary to assets.meta_json in D1.
- Create embeddings from generated or ingested text â†’ upsert to Vectorize (LangChain svc).

In DO (real-time)

- Compute immediate presentation_score heuristics for strokes (density, spacing) and quick answer checks.
- Buffer attempts and strokes; compute quick feedback (correct/incorrect hint).

Batch / Cron

- Periodic mastery recomputation per child/topic using attempts in D1 â†’ update progress.
- Schedule lesson generation jobs for children with gaps or low practice rates.
- Re-index or re-embed content if embedding model changes.

AI

- LangChain uses curriculum snippets (Vectorize) + child preferences + progress snapshot to generate tasks and printable HTML/PDF.

Sync

- DO â†’ Worker flushes buffered attempts/strokes to D1/R2 on interval or on session end.

### What to display (by persona)

Child

- Short progress indicator (level/badges), todayâ€™s tasks, live feedback, encourage messages; no raw backend details.

Parent

- Curriculum map with mastery per topic, scheduled lessons, recent attempts with scores & presentation notes, suggested activities/outings, subscription status.

Tutor (later)

- Student history, pending homework, scheduled lessons, notes from parents.

Teacher (later)

- Class-level aggregates (when integrated), suggested interventions.

### DO â†” D1 sync rules & patterns

- Write-first to DO for fast UX: client writes strokes/attempts to DO; DO acknowledges instantly.
- Flush policy (typical):
- Time-based flush (e.g., every 30â€“60s) OR buffer-size-based flush (e.g., every 10 attempts).
- On session end or network reconnect flush immediately.
- On flush: DO bundles attempts/strokes â†’ Worker persists to D1 (attempts), R2 (stroke blob) and returns persisted IDs. DO then marks buffer entries as persisted.
- Idempotency: use attempt_client_id (uuid) and job_id in payloads to dedupe writes when retries occur.
- Consistency: D1 is canonical; DOs must rehydrate from D1 on creation/restart (read last progress + last persisted assets).
- Failure handling: If DO â†’ Worker persist fails, do exponential backoff, write job entry in D1 jobs to retry. Keep DO buffer bounded to prevent unbounded memory growth â€” if full, persist directly to R2 with temporary flag and return soft error to client.

### Retention, privacy & consent

- Minimal PII: store only necessary identifiers. Keep display_name as alias; limit DOB to month/year or optional.
- Consent flags: required for wearable data, third-party content sharing, or tutor sharing. Stored in children.preferences_json.
- Retention policy:
- Active data: retained while account active.
- Inactivity: after 12 months, archive to R2 snapshot + mark for deletion; notify parent.
- Deletion: on parent request, remove D1 rows, delete R2 blobs, remove Vectorize entries associated to child (or anonymize).
- Export: provide parent export (JSON + zipped assets) endpoint.
- Regulatory: plan for COPPA & GDPR-K: parental consent recorded, no direct child account creation without parent consent.

### Indexing & performance guidance (D1 & Vectorize)

- D1 indexes: children.parent_user_id, attempts.child_id, progress.child_id, scheduled_lessons.child_id, curriculum_topics.subject.
- Pagination: always use cursor-based pagination for lists.
- Vectorize usage: store snippet metadata linking to topic_id and source_type. Keep vector length moderate (embed short sentences).
- DO sizing: flush often; store minimal in-memory footprint; archive stroke blobs to R2.

### Auditing, monitoring & telemetry

- Capture: job runs, failed flushes, DO buffer overflows, OCR errors, LLM cost per job, attempts per child, daily active children.
- Tables/logs: jobs table in D1 for audit (status, payload, errors), attempts final rows, assets metadata for audits.
- Alerts: persistent DO flush failures, job failure rates above threshold, LLM error spikes.

### API & contract surface (summary, DO-aware)

Client â†’ Worker

- POST /auth/verify (token) â†’ returns user_id
- POST /children â†’ create child (writes to D1)
- GET /children/:id â†’ read child + progress (D1)
- POST /assets/upload-url â†’ returns presigned R2 URL (Worker)
- POST /assets/notify â†’ Worker stores metadata in D1 and enqueues OCR (if required)
- POST /tasks/generate â†’ Worker enqueues LangChain generation job
- GET /lessons/scheduled?child_id= â†’ D1 read
- POST /attempts â†’ prefer via DO (WebSocket) message: attempt.create OR HTTP fallback to Worker (which writes to DO buffer)

DO â†” Worker

- POST /persist/attempts â†’ Worker persists buffered attempts to D1
- POST /persist/strokes â†’ Worker stores stroke blob to R2 and writes assets row in D1

Worker â†” LangChain

- POST /langchain/generate â†’ returns lesson + asset payload (LangChain writes to R2 or returns asset HTML)
- LangChain calls Worker callback /jobs/callback/langchain on completion (HMAC-signed)

### Security / access control considerations

- Authenticate all client connections with Firebase ID tokens. Worker validates and maps to user_id.
- For DO WebSocket join, Worker issues short-lived signed session token for DO to validate.
- Access checks: all D1 reads/writes filter by parent_user_id or child_owner (never return data outside parent scope).
- Enforce rate limits and quotas (per-child and per-parent) to avoid abuse.

## ğŸ” Security Plan â€” Education App (MVP) â€” Draft v1

### Security goals (high level)

- Protect childrenâ€™s personal data and parental account data.
- Ensure confidentiality, integrity, and availability of learning data and assets.
- Provide parental control & explicit consent for any data collection.
- Secure AI/third-party integrations and payment flows.
- Maintain auditability and rapid incident handling.

### Threat model (top risks)

- Unauthorized access to child profiles, attempts, or PII (data breach).
- Account takeover (parent account compromised).
- Unauthorized manipulation of progress/attempt records (fraud).
- Exfiltration of scanned worksheets, stroke data, or generated assets.
- Abuse of AI endpoints causing data leakage of other childrenâ€™s data.
- Malicious client input (image payloads, prompt injection).
- Denial of Service or resource exhaustion (LLM cost spikes).
- Regulatory non-compliance (COPPA, GDPR-K).
- Third-party risk (Stripe, Firebase, LLM provider, Vectorize).

### Authentication & Access Control

Design

- Auth provider: Firebase Auth (client). Worker validates Firebase ID tokens on every request.
- Role model: parent, child (no direct auth), tutor/teacher (later), admin.
- Mapping: D1 stores firebase_uid â†’ user_id mapping. All D1 reads/writes filter by parent_user_id.

Controls

- Token validation: Workers validate JWT signatures & exp; reject tokens with missing claims.
- Least privilege: APIs enforce authorization (owner-only access to children). No cross-tenant reads.
- Short-lived session tokens for DO WebSocket sessions issued by Worker (signed, TTL).
- Admin access: MFA required for admin accounts; admin actions audited.
- Password rules / MFA: Encourage/require strong passwords; support MFA for parents (recommendation).

### Network & Transport Security

- TLS everywhere: HTTPS/TLS enforced for all client â†” Worker and Worker â†” LangChain/third-party communications.
- Hardened endpoints: Rate limits, API keys, and request validation on all endpoints.
- Private secrets: All service keys kept in CI secrets and Cloudflare KV where appropriate; never checked into repo.
- Service-to-service auth: HMAC-signed callbacks (LangChain â†’ Worker), mutual TLS or API keys for internal calls.

### Data protection (storage & processing)

At-rest

- R2: object storage encrypted at rest by Cloudflare. Use signed URLs with short TTL for access to assets.
- D1: uses Cloudflare encryption. Minimise PII stored; store alias instead of full names where feasible.
- Vectorize: treat as sensitive â€” only store curriculum/embedding metadata; avoid storing direct child-identifying text in vector payloads.
- DO state: DO holds ephemeral sensitive data; flush to D1/R2 quickly; ensure DO persisted state inherits Cloudflare protections.

In transit

- TLS for all endpoints; validate certs for external APIs.

Sensitive fields & minimisation

- Store minimal PII (alias, DOB optional). Keep email only in users.
- Wearable/health data stored only with explicit parental consent; flag in D1 preferences_json.
- For audits, avoid logging raw images or stroke blobs; log references/IDs only.

### Durable Objects & Live Data Controls

- Auth handshake: Worker issues signed session token (short TTL) for DO WebSocket join; DO rejects unsigned sessions.
- Session isolation: DO instances keyed by child:<child_id> to isolate per-child state.
- Buffer limits: cap strokeBuffer and attemptBuffer size to prevent memory exhaustion. If buffer near capacity, persist chunk to R2 and continue.
- Flush integrity: attempts flushed to D1 must be idempotent (use client-generated attempt_client_id) to avoid duplication on retries.
- Audit sync: DO should log flush events to jobs table in D1 (or to R2) for traceability.

### API & Input Validation

- Strict schema validation for all endpoints (e.g., JSON Schema / Zod) to prevent injection attacks.
- Image handling: validate image MIME types and size limits; process images in trusted worker environment; scan for malware if necessary.
- Prompt safety: sanitize any user-provided text before sending to LLM. Separate child-specific data and avoid placing other childrenâ€™s PII in prompts.
- Rate limiting: per-user and global quotas on generation requests to prevent LLM abuse and cost spikes.

### AI & LLM-specific controls

- No PII in prompts: scrub or tokenise direct identifiers before sending to LLMs; use child_alias only and avoid explicit PII.
- Prompt injection defense: apply guardrails and structured prompt templates; isolate user content into data fields, not raw prompt concatenation.
- Logging & retention: log model usage metadata (model, tokens, cost) but never store full prompts with sensitive PII in logs. Store prompt hashes for audit.
- Content filtering: run LLM outputs through a simple filter to catch unsafe suggestions (e.g., medical/legal advice) and replace with safe guidance or â€œask a professionalâ€.
- Quota controls: implement spending caps and alerting for LLM usage.

### Payment & Billing security

- Stripe for subscriptions: redirect/host checkout pages when possible (Stripe Checkout) to minimise PCI scope.
- Webhook validation: validate Stripe webhooks (signing secret) and reconcile against D1 records.
- Minimal storage: do not store card details; store only stripe_customer_id and subscription_id.

### Logging, monitoring & auditability

- Audit logs: write jobs and key admin events to D1; store security-relevant events in an append-only log with timestamps (or use external log service).
- Error monitoring: Sentry for server and client; Cloudflare Analytics for edge metrics.
- Alerting: alerts for failed DO flush rates, repeated auth failures, high LLM spend, or R2 failures.
- Retention: keep security logs for at least 90 days; longer if required by policy.

### Backups & disaster recovery

- D1 backups: daily export snapshots to R2 (SQL dump or JSON). Keep rolling 30 days (initially).
- R2 assets: periodic replication policy / maintain index in D1 to correlate assets. For critical assets, keep checksum metadata.
- Vectorize: maintain backups of original text + embedding metadata in R2/D1 to allow reindexing.
- Recovery drills: schedule quarterly restore tests for D1 + R2 to validate backup integrity.

### Privacy, consent & regulatory

- Parental consent: required during onboarding; store consent record (timestamp, scope) in D1 children.preferences_json.
- COPPA: treat children under 13 as minors â€” require parental approval for account, prevent direct child signup, limit third-party data sharing.
- GDPR: fulfil rights â€” data access, export, correction, deletion. Provide automated export endpoint for parents. Log deletion actions.
- Data minimisation: default opt-out for telemetry/wearable data; explicit opt-in for sensitive telemetry.
- Data retention policy: archive after 12 months inactivity; deletion on request within legal SLA (e.g., 30 days).

### Third-party risk management

- Vendor list: Firebase (Auth), Cloudflare (Workers, D1, R2, Vectorize), LangChain + LLM provider (OpenAI), Stripe, Postmark/Resend, Google Vision (OCR) or Tesseract fallback.
- Controls: maintain vendor inventory, SLAs, data processing agreements (DPA), and ensure LLM provider DPA covers use of child-related data (if using for embeddings or prompts).
- Minimum data sharing: send minimal, non-identifiable data to vendors when possible.

### Secure development & QA practices

- Code reviews: mandatory pull requests + PR reviews for server code. Security owner sign-off for changes touching auth/data flows.
- Static analysis: run linters and SAST where possible (e.g., ESLint + TypeScript strict modes).
- Dependency monitoring: automated scanning for vulnerabilities (Dependabot/GitHub).
- Secrets management: no secrets in source; rely on CI secret store & Cloudflare KV.
- Pen testing: schedule pen-test prior to wider pilot; include client & server surface.

### Incident response & playbook (summary)

    1.	Detection / Triage: alert from monitoring (Sentry / Cloudflare) triggers on-call.
    2.	Containment: revoke API keys / rotate affected tokens; scale DO throttle; disable LLM calls if cost spike.
    3.	Eradication & Recovery: patch vulnerability; restore from backups if needed; replay critical jobs.
    4.	Notification: notify affected parents per policy and regulatory requirements (72-hour GDPR window for breaches).
    5.	Post-incident: root cause analysis, update controls, update runbooks.

Create a short incident response doc with contacts, escalation, and template notification messages.

### Privacy & Security documentation to produce (recommended)

- Data Protection Impact Assessment (DPIA) for COPPA/GDPR.
- Parental consent & privacy policy pages (clear UX copy).
- Incident Response Playbook (contact list, triage steps).
- Vendor DPA and security checklist.
- Access Control policy (who can access production D1/R2/Vectorize/Cloudflare console).
- Developer Security Handbook (secrets, PR rules, QA).

### Initial security checklist (practical tasks)

- Enforce HTTPS and strict TLS for all endpoints.
- Implement Firebase token validation in Workers.
- Issue signed short-lived DO session tokens via Worker.
- Enforce input schema validation on all endpoints.
- Cap DO buffers & implement flush-to-D1 logic with idempotency keys.
- Configure Cloudflare KV/Secrets & remove any local dev secrets.
- Implement presigned R2 upload with content type/size limits.
- Setup Stripe Checkout + webhook validation.
- Setup Sentry + Cloudflare Analytics + alerting for high-cost LLM usage.
- Implement parental consent capture & storage during onboarding.
- Create DPA with LLM provider & email provider (if required).
- Plan pen-test at end of MVP dev cycle.

### Quick templates & examples (to hand to engineers)

- HMAC callback verification: LangChain â†’ Worker callbacks must include X-Signature header (HMAC-SHA256 of payload using shared secret). Worker verifies before processing.
- Idempotency header: clients include X-Idempotency-Key for attempt submissions; Worker/D1 enforces uniqueness.
- Session token: Worker returns do_session_token = HMAC(user_id|child_id|exp) for DO join; DO verifies signature and expiry.

## Next Steps

### Technical Short next-steps (practical checklist)

1. Create Cloudflare account & provision Workers, D1, R2, Vectorize, KV, Durable Objects.
2. Set up Firebase Auth (enable email sign-in) and publish keys.
3. Scaffold monorepo (Expo mobile, Workers, LangChain svc, shared-types).
4. Provision Stripe + test keys, Postmark/Resend for emails.
5. Implement onboarding flow client â†’ Worker â†’ D1 and Firebase token verification.
6. Build LangChain stub /generate-exercise via simple prompt + Vectorize retrieval.
7. Implement presigned R2 upload flow, OCR pipeline, and minimal printable PDF pipeline.
8. Add Cron Trigger + Worker cron endpoint stub and Durable Object lock.
9. Run pilot with 10â€“20 families, collect feedback & iterate.

### Implementation & rollout priorities (next actions)

1. Define DO interface: messages (stroke.delta, attempt.create, flush.request, session.join). I can draft this next.
2. Implement D1 schema: create canonical tables for users, children, curriculum, tasks, attempts, progress, scheduled_lessons, assets, jobs.
3. Implement DO flush strategy (time/buffer thresholds + idempotent persist).
4. Integrate R2 upload flow and OCR stub.
5. LangChain job contract for generation; store resulting assets in R2 and metadata in D1.
6. Build minimal client flows: onboarding â†’ create child â†’ session start â†’ attempt â†’ flush â†’ parent dashboard reads D1.

### Offer: I can produce these artifacts next (pick one or more)

â€¢ A compact Durable Object interface spec (message schema for WebSocket & Worker calls).
â€¢ A revised D1 schema SQL reflecting DO-managed buffering and no raw strokes columns.
â€¢ Pseudocode for DO flush logic (timers, batching, retry/backoff, idempotency).
â€¢ API OpenAPI (YAML) for the endpoints listed (MVP subset).
